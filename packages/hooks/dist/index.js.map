{"version":3,"file":"index.js","sources":["../src/hooks/use-debounced-callback.ts","../src/hooks/use-is-mount.ts","../src/hooks/use-pgs.tsx","../src/index.ts"],"sourcesContent":["import _ from 'lodash';\nimport { useCallback, useRef } from 'react';\n\nconst useDebouncedCallback = (callback, delay, opts?) => {\n  const callbackRef: any = useRef();\n  callbackRef.current = callback;\n  return useCallback(\n    _.debounce((...args) => callbackRef.current(...args), delay, opts),\n    [],\n  );\n};\n\nexport default useDebouncedCallback;\n","import { useEffect, useRef } from 'react';\n\nconst useIsMount = () => {\n  const isMountRef = useRef(false);\n  useEffect(() => {\n    isMountRef.current = true;\n    return () => {\n      isMountRef.current = false;\n    };\n  }, []);\n  return isMountRef.current;\n};\n\nexport default useIsMount;\n","import _ from 'lodash';\nimport { useEffect, useMemo, useReducer, useRef } from 'react';\nimport {\n  PaginatedResponseModel,\n  PaginatedSearchRequestModel,\n} from '@shadow-walker-test/core';\nimport useDebouncedCallback from './use-debounced-callback';\nconst randomId = () => Math.floor(Math.random() * 999 * Math.floor(9999999999));\ntype FetcherType = (\n  // eslint-disable-next-line no-unused-vars\n  x: PaginatedSearchRequestModel | any\n) => Promise<PaginatedResponseModel<any>>;\n\ninterface StoreType {\n  instanceId: number;\n  fetcher: FetcherType | any;\n  isFetching: boolean;\n  pageIndex: number;\n  pageSize: number;\n  rowCount: number;\n  searchText: string;\n  fetchedOnce: boolean;\n  fetchIds: number[];\n  list: any[];\n  minText: number;\n  initialized: boolean;\n  brokenMessage: string;\n}\n\ninterface Config {\n  fetcher: FetcherType;\n  fetchOnMount: boolean;\n  minText: number;\n  extraArgs?: any;\n}\n\ntype Action = { type: any; payload?: any };\n\nconst initialStore: StoreType = {\n  instanceId: randomId(),\n  fetcher: () => Promise.resolve(),\n  isFetching: false,\n  pageIndex: 1,\n  pageSize: 20,\n  rowCount: 0,\n  searchText: '',\n  fetchedOnce: false,\n  list: [],\n  fetchIds: [],\n  minText: 0,\n  initialized: false,\n  brokenMessage: '',\n};\n\nconst reducer = (state: StoreType, action: Action): StoreType => {\n  switch (action.type) {\n    case 'init':\n      return {\n        ...state,\n        ...action.payload,\n        initialized: true,\n        instanceId: randomId(),\n      };\n    case 'reset':\n      return { ...action.payload };\n    case 'increaseIndex':\n      return { ...state, pageIndex: state.pageIndex + 1 };\n    case 'changeText':\n      return {\n        ...state,\n        list: [],\n        searchText: action.payload,\n        rowCount: 0,\n        pageIndex: 1,\n        fetchedOnce: false,\n      };\n    case 'setLoad':\n      return { ...state, isFetching: action.payload, brokenMessage: '' };\n    case 'addFetchId':\n      return { ...state, fetchIds: [...state.fetchIds, action.payload] };\n    case 'removeFetchId':\n      return {\n        ...state,\n        fetchIds: state.fetchIds.filter((x) => x !== action.payload),\n      };\n    case 'addList':\n      if (_.last(state.fetchIds) === action.payload.fetchId)\n        return {\n          ...state,\n          fetchedOnce: true,\n          list: [...state.list, ...action.payload.result],\n          rowCount: action.payload.rowCount,\n        };\n      return {\n        ...state,\n      };\n    case 'setError':\n      return { ...state, brokenMessage: action.payload, isFetching: false };\n    case 'setInitialized':\n      return {\n        ...state,\n        initialized: action.payload,\n      };\n\n    default:\n      return state;\n  }\n};\n\nconst usePgs = (initialConfig: Config) => {\n  const [store, unsafeDispatch]: [any, any] = useReducer(reducer, initialStore);\n\n  const isMountRef = useRef(false);\n\n  const loading = useMemo(\n    () => store.isFetching || store.fetchIds.length > 0,\n    [store.isFetching, store.fetchIds]\n  );\n\n  const isFull = useMemo(\n    () => store.list.length >= store.rowCount && store.fetchedOnce,\n    [store.list, store.rowCount, store.fetchedOnce]\n  );\n\n  useEffect(() => {\n    isMountRef.current = true;\n    return () => {\n      isMountRef.current = false;\n    };\n  }, []);\n  const dispatch = (...args) => {\n    if (isMountRef.current) unsafeDispatch(...args);\n  };\n  const init = (config: Config) => {\n    dispatch({\n      type: 'init',\n      payload: { ...initialStore, ...config },\n    });\n  };\n\n  useEffect(() => {\n    init(initialConfig);\n  }, [initialConfig.extraArgs]);\n\n  useEffect(() => {\n    dispatch({\n      type: 'clearPreFetchedValues',\n    });\n  }, [store.initialized]);\n\n  const load = (isLoading) => {\n    dispatch({\n      type: 'setLoad',\n      payload: isLoading,\n    });\n  };\n\n  const addFetchId = (fetchId) => {\n    dispatch({\n      type: 'addFetchId',\n      payload: fetchId,\n    });\n  };\n\n  const removeFetchId = (fetchId) => {\n    dispatch({\n      type: 'removeFetchId',\n      payload: fetchId,\n    });\n  };\n\n  const setError = (message) => {\n    dispatch({\n      type: 'setError',\n      payload: message,\n    });\n  };\n\n  const fetch = () => {\n    const fetchId = randomId();\n    load(true);\n    addFetchId(fetchId);\n\n    (store.fetcher as FetcherType)({\n      pageIndex: store.pageIndex,\n      pageSize: store.pageSize,\n      searchText: store.searchText,\n      ...(initialConfig.extraArgs || {}),\n    })\n      .then((resp) => {\n        dispatch({\n          type: 'addList',\n          payload: { ...resp.data, fetchId },\n        });\n\n        removeFetchId(fetchId);\n        load(false);\n      })\n      .catch((err) => {\n        removeFetchId(fetchId);\n        setError(\n          (err?.response?.errors?.length > 0 &&\n            err.response.errors[0]?.message) ||\n            ''\n        );\n      });\n  };\n\n  const debouncedFetch = useDebouncedCallback(() => {\n    fetch();\n  }, 500);\n\n  useEffect(() => {\n    if (\n      !isFull &&\n      store.initialized &&\n      store.searchText.length >= store.minText\n    ) {\n      load(true);\n      debouncedFetch();\n    }\n  }, [\n    store.pageIndex,\n    store.searchText,\n    store.initialized,\n    store.minText,\n    store.instanceId,\n  ]);\n\n  const increaseIndex = () => {\n    if (!store.isFetching) {\n      dispatch({\n        type: 'increaseIndex',\n      });\n    }\n  };\n\n  const changeSearchText = (text) => {\n    dispatch({\n      type: 'changeText',\n      payload: text,\n    });\n  };\n\n  const onTryAgain = () => {\n    load(true);\n    debouncedFetch();\n  };\n\n  return {\n    options: store.list,\n    loading,\n    isFull,\n    selectTemplate: {\n      brokenMessage: store.brokenMessage,\n      options: store.list,\n      loading,\n      // isFull,\n      onScrollBottom: increaseIndex,\n      onSearch: changeSearchText,\n      serverSideSearch: true,\n      minSearchText: store.minText,\n      onTryAgain,\n      // onFocus: () => {\n      //   load(false);\n      // },\n    },\n    store,\n  };\n};\n\nexport default usePgs;\n","import useDebouncedCallback from './hooks/use-debounced-callback';\nimport useIsMount from './hooks/use-is-mount';\nimport usePgs from './hooks/use-pgs';\n\nconsole.log('asd', usePgs);\nexport { useDebouncedCallback, useIsMount, usePgs };\n\n// import useJsPg from './js-ho/use-js-pg';\n// export { useJsPg };\n"],"names":["useDebouncedCallback","callback","delay","opts","callbackRef","useRef","current","useCallback","_","debounce","useIsMount","isMountRef","useEffect","randomId","Math","floor","random","initialStore","instanceId","fetcher","Promise","resolve","isFetching","pageIndex","pageSize","rowCount","searchText","fetchedOnce","list","fetchIds","minText","initialized","brokenMessage","reducer","state","action","type","payload","filter","x","last","fetchId","result","usePgs","initialConfig","useReducer","store","unsafeDispatch","loading","useMemo","length","isFull","dispatch","init","config","extraArgs","load","isLoading","addFetchId","removeFetchId","setError","message","fetch","then","resp","data","err","response","errors","debouncedFetch","increaseIndex","changeSearchText","text","onTryAgain","options","selectTemplate","onScrollBottom","onSearch","serverSideSearch","minSearchText","console","log"],"mappings":";;;;;;;;;;;;;;;;IAGMA,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,QAAD,EAAWC,KAAX,EAAkBC,IAAlB,EAA4B;AACvD,MAAMC,WAAgB,GAAGC,YAAM,EAA/B;AACAD,EAAAA,WAAW,CAACE,OAAZ,GAAsBL,QAAtB;AACA,SAAOM,iBAAW,CAChBC,qBAAC,CAACC,QAAF,CAAW;AAAA,WAAaL,WAAW,CAACE,OAAZ,OAAAF,WAAW,YAAxB;AAAA,GAAX,EAAsDF,KAAtD,EAA6DC,IAA7D,CADgB,EAEhB,EAFgB,CAAlB;AAID;;ICRKO,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvB,MAAMC,UAAU,GAAGN,YAAM,CAAC,KAAD,CAAzB;AACAO,EAAAA,eAAS,CAAC,YAAM;AACdD,IAAAA,UAAU,CAACL,OAAX,GAAqB,IAArB;AACA,WAAO,YAAM;AACXK,MAAAA,UAAU,CAACL,OAAX,GAAqB,KAArB;AACD,KAFD;AAGD,GALQ,EAKN,EALM,CAAT;AAMA,SAAOK,UAAU,CAACL,OAAlB;AACD;;ACJD,IAAMO,QAAQ,GAAG,SAAXA,QAAW;AAAA,SAAMC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,GAAhB,GAAsBF,IAAI,CAACC,KAAL,CAAW,UAAX,CAAjC,CAAN;AAAA,CAAjB;;AA+BA,IAAME,YAAuB,GAAG;AAC9BC,EAAAA,UAAU,EAAEL,QAAQ,EADU;AAE9BM,EAAAA,OAAO,EAAE;AAAA,WAAMC,OAAO,CAACC,OAAR,EAAN;AAAA,GAFqB;AAG9BC,EAAAA,UAAU,EAAE,KAHkB;AAI9BC,EAAAA,SAAS,EAAE,CAJmB;AAK9BC,EAAAA,QAAQ,EAAE,EALoB;AAM9BC,EAAAA,QAAQ,EAAE,CANoB;AAO9BC,EAAAA,UAAU,EAAE,EAPkB;AAQ9BC,EAAAA,WAAW,EAAE,KARiB;AAS9BC,EAAAA,IAAI,EAAE,EATwB;AAU9BC,EAAAA,QAAQ,EAAE,EAVoB;AAW9BC,EAAAA,OAAO,EAAE,CAXqB;AAY9BC,EAAAA,WAAW,EAAE,KAZiB;AAa9BC,EAAAA,aAAa,EAAE;AAbe,CAAhC;;AAgBA,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAACC,KAAD,EAAmBC,MAAnB,EAAiD;AAC/D,UAAQA,MAAM,CAACC,IAAf;AACE,SAAK,MAAL;AACE,+BACKF,KADL,EAEKC,MAAM,CAACE,OAFZ;AAGEN,QAAAA,WAAW,EAAE,IAHf;AAIEb,QAAAA,UAAU,EAAEL,QAAQ;AAJtB;;AAMF,SAAK,OAAL;AACE,+BAAYsB,MAAM,CAACE,OAAnB;;AACF,SAAK,eAAL;AACE,+BAAYH,KAAZ;AAAmBX,QAAAA,SAAS,EAAEW,KAAK,CAACX,SAAN,GAAkB;AAAhD;;AACF,SAAK,YAAL;AACE,+BACKW,KADL;AAEEN,QAAAA,IAAI,EAAE,EAFR;AAGEF,QAAAA,UAAU,EAAES,MAAM,CAACE,OAHrB;AAIEZ,QAAAA,QAAQ,EAAE,CAJZ;AAKEF,QAAAA,SAAS,EAAE,CALb;AAMEI,QAAAA,WAAW,EAAE;AANf;;AAQF,SAAK,SAAL;AACE,+BAAYO,KAAZ;AAAmBZ,QAAAA,UAAU,EAAEa,MAAM,CAACE,OAAtC;AAA+CL,QAAAA,aAAa,EAAE;AAA9D;;AACF,SAAK,YAAL;AACE,+BAAYE,KAAZ;AAAmBL,QAAAA,QAAQ,YAAMK,KAAK,CAACL,QAAZ,GAAsBM,MAAM,CAACE,OAA7B;AAA3B;;AACF,SAAK,eAAL;AACE,+BACKH,KADL;AAEEL,QAAAA,QAAQ,EAAEK,KAAK,CAACL,QAAN,CAAeS,MAAf,CAAsB,UAACC,CAAD;AAAA,iBAAOA,CAAC,KAAKJ,MAAM,CAACE,OAApB;AAAA,SAAtB;AAFZ;;AAIF,SAAK,SAAL;AACE,UAAI7B,qBAAC,CAACgC,IAAF,CAAON,KAAK,CAACL,QAAb,MAA2BM,MAAM,CAACE,OAAP,CAAeI,OAA9C,EACE,yBACKP,KADL;AAEEP,QAAAA,WAAW,EAAE,IAFf;AAGEC,QAAAA,IAAI,YAAMM,KAAK,CAACN,IAAZ,EAAqBO,MAAM,CAACE,OAAP,CAAeK,MAApC,CAHN;AAIEjB,QAAAA,QAAQ,EAAEU,MAAM,CAACE,OAAP,CAAeZ;AAJ3B;AAMF,+BACKS,KADL;;AAGF,SAAK,UAAL;AACE,+BAAYA,KAAZ;AAAmBF,QAAAA,aAAa,EAAEG,MAAM,CAACE,OAAzC;AAAkDf,QAAAA,UAAU,EAAE;AAA9D;;AACF,SAAK,gBAAL;AACE,+BACKY,KADL;AAEEH,QAAAA,WAAW,EAAEI,MAAM,CAACE;AAFtB;;AAKF;AACE,aAAOH,KAAP;AAlDJ;AAoDD,CArDD;;IAuDMS,MAAM,GAAG,SAATA,MAAS,CAACC,aAAD,EAA2B;AACxC,oBAA4CC,gBAAU,CAACZ,OAAD,EAAUhB,YAAV,CAAtD;AAAA,MAAO6B,KAAP;AAAA,MAAcC,cAAd;;AAEA,MAAMpC,UAAU,GAAGN,YAAM,CAAC,KAAD,CAAzB;AAEA,MAAM2C,OAAO,GAAGC,aAAO,CACrB;AAAA,WAAMH,KAAK,CAACxB,UAAN,IAAoBwB,KAAK,CAACjB,QAAN,CAAeqB,MAAf,GAAwB,CAAlD;AAAA,GADqB,EAErB,CAACJ,KAAK,CAACxB,UAAP,EAAmBwB,KAAK,CAACjB,QAAzB,CAFqB,CAAvB;AAKA,MAAMsB,MAAM,GAAGF,aAAO,CACpB;AAAA,WAAMH,KAAK,CAAClB,IAAN,CAAWsB,MAAX,IAAqBJ,KAAK,CAACrB,QAA3B,IAAuCqB,KAAK,CAACnB,WAAnD;AAAA,GADoB,EAEpB,CAACmB,KAAK,CAAClB,IAAP,EAAakB,KAAK,CAACrB,QAAnB,EAA6BqB,KAAK,CAACnB,WAAnC,CAFoB,CAAtB;AAKAf,EAAAA,eAAS,CAAC,YAAM;AACdD,IAAAA,UAAU,CAACL,OAAX,GAAqB,IAArB;AACA,WAAO,YAAM;AACXK,MAAAA,UAAU,CAACL,OAAX,GAAqB,KAArB;AACD,KAFD;AAGD,GALQ,EAKN,EALM,CAAT;;AAMA,MAAM8C,QAAQ,GAAG,SAAXA,QAAW,GAAa;AAC5B,QAAIzC,UAAU,CAACL,OAAf,EAAwByC,cAAc,MAAd;AACzB,GAFD;;AAGA,MAAMM,IAAI,GAAG,SAAPA,IAAO,CAACC,MAAD,EAAoB;AAC/BF,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE,MADC;AAEPC,MAAAA,OAAO,oBAAOpB,YAAP,EAAwBqC,MAAxB;AAFA,KAAD,CAAR;AAID,GALD;;AAOA1C,EAAAA,eAAS,CAAC,YAAM;AACdyC,IAAAA,IAAI,CAACT,aAAD,CAAJ;AACD,GAFQ,EAEN,CAACA,aAAa,CAACW,SAAf,CAFM,CAAT;AAIA3C,EAAAA,eAAS,CAAC,YAAM;AACdwC,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE;AADC,KAAD,CAAR;AAGD,GAJQ,EAIN,CAACU,KAAK,CAACf,WAAP,CAJM,CAAT;;AAMA,MAAMyB,IAAI,GAAG,SAAPA,IAAO,CAACC,SAAD,EAAe;AAC1BL,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE,SADC;AAEPC,MAAAA,OAAO,EAAEoB;AAFF,KAAD,CAAR;AAID,GALD;;AAOA,MAAMC,UAAU,GAAG,SAAbA,UAAa,CAACjB,OAAD,EAAa;AAC9BW,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE,YADC;AAEPC,MAAAA,OAAO,EAAEI;AAFF,KAAD,CAAR;AAID,GALD;;AAOA,MAAMkB,aAAa,GAAG,SAAhBA,aAAgB,CAAClB,OAAD,EAAa;AACjCW,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE,eADC;AAEPC,MAAAA,OAAO,EAAEI;AAFF,KAAD,CAAR;AAID,GALD;;AAOA,MAAMmB,QAAQ,GAAG,SAAXA,QAAW,CAACC,OAAD,EAAa;AAC5BT,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE,UADC;AAEPC,MAAAA,OAAO,EAAEwB;AAFF,KAAD,CAAR;AAID,GALD;;AAOA,MAAMC,KAAK,GAAG,SAARA,KAAQ,GAAM;AAClB,QAAMrB,OAAO,GAAG5B,QAAQ,EAAxB;AACA2C,IAAAA,IAAI,CAAC,IAAD,CAAJ;AACAE,IAAAA,UAAU,CAACjB,OAAD,CAAV;AAECK,IAAAA,KAAK,CAAC3B,OAAP;AACEI,MAAAA,SAAS,EAAEuB,KAAK,CAACvB,SADnB;AAEEC,MAAAA,QAAQ,EAAEsB,KAAK,CAACtB,QAFlB;AAGEE,MAAAA,UAAU,EAAEoB,KAAK,CAACpB;AAHpB,OAIMkB,aAAa,CAACW,SAAd,IAA2B,EAJjC,GAMGQ,IANH,CAMQ,UAACC,IAAD,EAAU;AACdZ,MAAAA,QAAQ,CAAC;AACPhB,QAAAA,IAAI,EAAE,SADC;AAEPC,QAAAA,OAAO,oBAAO2B,IAAI,CAACC,IAAZ;AAAkBxB,UAAAA,OAAO,EAAPA;AAAlB;AAFA,OAAD,CAAR;AAKAkB,MAAAA,aAAa,CAAClB,OAAD,CAAb;AACAe,MAAAA,IAAI,CAAC,KAAD,CAAJ;AACD,KAdH,WAeS,UAACU,GAAD,EAAS;AAAA;;AACdP,MAAAA,aAAa,CAAClB,OAAD,CAAb;AACAmB,MAAAA,QAAQ,CACL,CAAAM,GAAG,QAAH,6BAAAA,GAAG,CAAEC,QAAL,2DAAeC,MAAf,0CAAuBlB,MAAvB,IAAgC,CAAhC,8BACCgB,GAAG,CAACC,QAAJ,CAAaC,MAAb,CAAoB,CAApB,CADD,qBACC,sBAAwBP,OADzB,CAAD,IAEE,EAHI,CAAR;AAKD,KAtBH;AAuBD,GA5BD;;AA8BA,MAAMQ,cAAc,GAAGrE,oBAAoB,CAAC,YAAM;AAChD8D,IAAAA,KAAK;AACN,GAF0C,EAExC,GAFwC,CAA3C;AAIAlD,EAAAA,eAAS,CAAC,YAAM;AACd,QACE,CAACuC,MAAD,IACAL,KAAK,CAACf,WADN,IAEAe,KAAK,CAACpB,UAAN,CAAiBwB,MAAjB,IAA2BJ,KAAK,CAAChB,OAHnC,EAIE;AACA0B,MAAAA,IAAI,CAAC,IAAD,CAAJ;AACAa,MAAAA,cAAc;AACf;AACF,GATQ,EASN,CACDvB,KAAK,CAACvB,SADL,EAEDuB,KAAK,CAACpB,UAFL,EAGDoB,KAAK,CAACf,WAHL,EAIDe,KAAK,CAAChB,OAJL,EAKDgB,KAAK,CAAC5B,UALL,CATM,CAAT;;AAiBA,MAAMoD,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC1B,QAAI,CAACxB,KAAK,CAACxB,UAAX,EAAuB;AACrB8B,MAAAA,QAAQ,CAAC;AACPhB,QAAAA,IAAI,EAAE;AADC,OAAD,CAAR;AAGD;AACF,GAND;;AAQA,MAAMmC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,IAAD,EAAU;AACjCpB,IAAAA,QAAQ,CAAC;AACPhB,MAAAA,IAAI,EAAE,YADC;AAEPC,MAAAA,OAAO,EAAEmC;AAFF,KAAD,CAAR;AAID,GALD;;AAOA,MAAMC,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvBjB,IAAAA,IAAI,CAAC,IAAD,CAAJ;AACAa,IAAAA,cAAc;AACf,GAHD;;AAKA,SAAO;AACLK,IAAAA,OAAO,EAAE5B,KAAK,CAAClB,IADV;AAELoB,IAAAA,OAAO,EAAPA,OAFK;AAGLG,IAAAA,MAAM,EAANA,MAHK;AAILwB,IAAAA,cAAc,EAAE;AACd3C,MAAAA,aAAa,EAAEc,KAAK,CAACd,aADP;AAEd0C,MAAAA,OAAO,EAAE5B,KAAK,CAAClB,IAFD;AAGdoB,MAAAA,OAAO,EAAPA,OAHc;AAKd4B,MAAAA,cAAc,EAAEN,aALF;AAMdO,MAAAA,QAAQ,EAAEN,gBANI;AAOdO,MAAAA,gBAAgB,EAAE,IAPJ;AAQdC,MAAAA,aAAa,EAAEjC,KAAK,CAAChB,OARP;AASd2C,MAAAA,UAAU,EAAVA;AATc,KAJX;AAkBL3B,IAAAA,KAAK,EAALA;AAlBK,GAAP;AAoBD;;ACzQDkC,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBtC,MAAnB;;;;;;"}